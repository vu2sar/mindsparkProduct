function applyProtractor(t,e){globalId=t,globalType=e,$("#"+globalId).live("mouseup",function(){window.focus()}),"IMG"==$("#"+t)[0].tagName&&(source=$("#"+t).attr("src")),dimensionArr=getDimensions();var o="";o+='<div id="'+t+'">',o+='<div id="protractor_block">',2==e?(o+='<div id="leftRotate">&#8634;</div>',o+='<div id="protractor_block1"></div>',o+='<div id="rightRotate">&#8634;</div>'):(o+='<div id="leftRotate">&#8597;</div>',o+='<div id="protractor_block1"></div>',o+='<div id="rightRotate">&#8597;</div>'),o+="</div>",o+="</div>",$("#"+t).replaceWith(o);var r='<button id="help1" class="promptOkButton" onclick="showPrompt();">Help</button>';r+='<div id="frontScreen"></div>',r+=prompt(),$("#container").append(r),$("#promptHolder").draggable({containment:"#container"}),$("#"+t).draggable({handle:"#protractor_block1"}),flagHeight&&(protHeight=1==e?2*parseInt(dimensionArr[1])+"px":dimensionArr[1],flagHeight=!1),resetProtractor(),applyCss(),addEvents(),osDetection()&&hame("#container","#"+t)}function applyCss(){1==globalType?($("#leftRotate").css({position:"absolute",left:"0px",top:"40%",width:"30px",height:"30px",cursor:"pointer","font-size":"30px","line-height":"30px","text-align":"right","font-family":"Comic Sans MS","-webkit-transform":"translate(-100%,0)","-moz-transform":"translate(-100%,0)","-ms-transform":"translate(-100%,0)",transform:"translate(-100%,0)"}),$("#rightRotate").css({position:"absolute",left:parseInt($("#"+globalId).css("width"))-30+"px",top:"40%",width:"30px",height:"30px",cursor:"pointer","font-size":"30px","line-height":"30px","font-family":"Comic Sans MS","z-index":"30000000","-webkit-transform":"translate(100%,0)","-moz-transform":"translate(100%,0)","-ms-transform":"translate(100%,0)",transform:"translate(100%,0)"}),$("#"+globalId).css({height:protHeight,width:$("#"+globalId).css("width"),border:"none",background:"","transform-origin":"50% 47%","ms-transform-origin":"50% 47%","o-transform-origin":"50% 47%","moz-transform-origin":"50% 47%","webkit-transform-origin":"50% 47%"})):($("#leftRotate").css({position:"absolute",left:"-16px",top:"95%",width:"30px",height:"30px",cursor:"pointer","font-size":"34px","line-height":"30px","text-align":"right","font-family":"Comic Sans MS",transform:"rotate(-340deg)","-webkit-transform":"rotate(-340deg)","-ms-transform":"rotate(-340deg)","-moz-transform":"rotate(-340deg)","-o-transform":"rotate(-340deg)"}),$("#rightRotate").css({position:"absolute",left:"95%",top:"-20px",width:"30px",height:"30px",cursor:"pointer","font-size":"34px","line-height":"30px","text-align":"center","font-family":"Comic Sans MS",transform:"rotate(235deg)","-moz-transform":"rotate(235deg)","-o-transform":"rotate(235deg)","-ms-transform":"rotate(235deg)","-webkit-transform":"rotate(235deg)"}),$("#"+globalId).css({height:protHeight,width:$("#"+globalId).css("width"),border:"none",background:"","transform-origin":"0% 0%","ms-transform-origin":"0% 0%","o-transform-origin":"0% 0%","moz-transform-origin":"0% 0%","webkit-transform-origin":"0% 0%"})),$("#protractor_block").css({position:"relative",top:"0px",left:"0px",height:protHeight,width:$("#"+globalId).css("width"),background:"","-webkit-transform":"translate3d(0, 0, 0)",overflow:"visible"}),$("#protractor_block1").css({"background-image":"url("+source+")","background-size":"contain","background-repeat":"no-repeat",height:dimensionArr[1],width:dimensionArr[0],cursor:"move","-webkit-transform":"translate3d(0, 0, 0)",overflow:"visible"}),$("#promptHolder").css({padding:"12px",color:"rgb(2, 0, 0)","font-size":"16px","font-weight":"normal",border:"5px solid rgb(43, 40, 40)",display:"none",background:"rgb(241, 238, 234)","text-align":"center",position:"absolute",top:"50px",right:"10px","z-index":"50",cursor:"default","-webkit-box-shadow":"5px 3px 17px rgba(172, 149, 149, 0.4)","-moz-box-shadow":"5px 3px 17px rgba(172, 149, 149, 0.4)","-o-box-shadow":"5px 3px 17px rgba(172, 149, 149, 0.4)","-ms-box-shadow":"5px 3px 17px rgba(172, 149, 149, 0.4)",width:"479px"}),$(".promptOkButton").css({padding:"0px",outline:"none",color:"white","font-weight":"bold","font-size":"15p",height:"25px","font-family":"arial",display:"inline-block",cursor:"pointer","margin-top":"20px",border:"1px solid rgb(61, 112, 6)","text-align":"center","background-color":"white","-webkit-box-shadow":"0px 8px 13px rgba(0, 0, 0, 0.4)","-moz-box-shadow":"0px 8px 13px rgba(0, 0, 0, 0.4)","-o-box-shadow":"0px 8px 13px rgba(0, 0, 0, 0.4)","-ms-box-shadow":"0px 8px 13px rgba(0, 0, 0, 0.4)",background:"-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #86D81E), color-stop(1, #518B07) )",background:"-moz-linear-gradient( center top, #86D81E 5%, #518B07 100% )",filter:"progid:DXImageTransform.Microsoft.gradient(startColorstr='#86D81E', endColorstr='#518B07')","background-color":"rgb(116, 167, 53)"}),$("#frontScreen").css({width:$("#container").css("width"),height:$("#container").css("height"),"background-color":"rgba(0,0,0,0.01)",position:"absolute",top:"0px",left:"0px","z-index":"49",display:"none"}),$("#arrows").css({background:"url('../../../../assets/keys.png')",width:"80px",height:"60px","background-repeat":"no-repeat","background-size":"contain",position:"relative",top:"5px",left:"0px",display:"inline-block","vertical-align":"middle","margin-right":"20px"}),$(".shift").css({background:"url('../../../../assets/shift.png')",width:"80px",height:"31px","background-repeat":"no-repeat","background-size":"contain",position:"relative",top:"5px",left:"0px",display:"inline-block","vertical-align":"middle"}),$("#leftkey").css({background:"url('../../../../assets/leftkey.png')",width:"31px",height:"30px","background-repeat":"no-repeat","background-size":"contain",position:"relative",top:"5px",left:"0px",display:"inline-block","vertical-align":"middle","margin-right":"20px"}),$("#rightkey").css({background:"url('../../../../assets/rightkey.png')",width:"31px",height:"30px","background-repeat":"no-repeat","background-size":"contain",position:"relative",top:"5px",left:"0px",display:"inline-block","vertical-align":"middle","margin-right":"20px"}),$(".text").css({display:"inline-block","vertical-align":"middle","margin-top":"7px","text-align":"center"}),$("#moveText").css({display:"block"}),$("#both").css({width:"257px",display:"inline-block",height:"90px","vertical-align":"middle","margin-left":"54px"}),$("#arrowText").css({display:"inline-block","vertical-align":"middle",width:"85px","margin-left":"60px"}),$(".plus").css({height:"30px","vertical-align":"middle","line-height":"33px",display:"inline-block"}),$("#help1").css({position:"absolute",right:"10px",top:"10px",display:"block",padding:"5px 10px",left:"initial",width:"54px",margin:"0px"})}function addEvents(){$("#rightRotate,#leftRotate").mousedown(function(t){startRight(t)}),document.getElementById("rightRotate").addEventListener("touchstart",function(t){startRight(t)}),document.getElementById("leftRotate").addEventListener("touchstart",function(t){startRight(t)}),document.addEventListener("touchmove",moveProtractor,!1),document.addEventListener("touchend",function(){isDrag=!1})}function startRight(t){isDrag=!0,t.preventDefault(),1==globalType?(h_y=parseInt($("#"+globalId).css("top"))+parseInt($("#"+globalId).css("height"))/2,h_x=parseInt($("#"+globalId).css("left"))+parseInt($("#"+globalId).css("width"))/2):(h_y=parseInt($("#"+globalId).css("top")),h_x=parseInt($("#"+globalId).css("left")));var e,o;if(t.touches)e=t.touches[0].clientX,o=t.touches[0].clientY;else{if(!t.pageX)return;e=t.pageX,o=t.pageY}var r=Math.atan2(e-h_x,o-h_y);degree=r*(180/Math.PI)*-1}function moveProtractor(t){if(isDrag){var e,o;if(t.touches)e=t.touches[0].clientX,o=t.touches[0].clientY;else{if(!t.pageX)return;e=t.pageX,o=t.pageY}var r=Math.atan2(e-h_x,o-h_y),a=r*(180/Math.PI)*-1;degree1=startRotation+(a-degree),$("#"+globalId).css("-moz-transform","scaleX("+scaleFactor+") scaleY("+scaleFactor+") rotate("+degree1+"deg)"),$("#"+globalId).css("-webkit-transform","scaleX("+scaleFactor+") scaleY("+scaleFactor+") rotate("+degree1+"deg)"),$("#"+globalId).css("-o-transform","scaleX("+scaleFactor+") scaleY("+scaleFactor+") rotate("+degree1+"deg)"),$("#"+globalId).css("-ms-transform","scaleX("+scaleFactor+") scaleY("+scaleFactor+") rotate("+degree1+"deg)"),$("#"+globalId).css("transform","scaleX("+scaleFactor+") scaleY("+scaleFactor+") rotate("+degree1+"deg)")}}function resetProtractor(){applyCss(),scaleFactor=1,startRotation=0,degree1=0,degree=0}function hame(t,e){function o(t){if(m=t.gesture.rotation,0!=startRotation&&(u=!1,b=startRotation),x=f,1==u){var e="scaleX("+scaleFactor+") scaleY("+scaleFactor+") rotate("+m+"deg)";a.css({webkitTransform:e,webkitTransformOrigin:f,transform:e,transformOrigin:f})}else{m=b+m;var o="scaleX("+scaleFactor+") scaleY("+scaleFactor+") rotate("+m+"deg)";a.css({webkitTransform:o,webkitTransformOrigin:x,transform:o,transformOrigin:x})}}var r=$(t).hammer({prevent_default:!1,drag:!0,transform:!0,touch:!0,drag_min_distance:0,transform_min_rotation:0,transform_min_scale:0}),a=$(e),i=.5,s=2;scaleFactor=1;var n=1,l=0,c=0,d=0,p=0,g=0,h=0,f="",m=0,b=0,u=!0,x="";r.on("transformstart",function(t){l=t.gesture.touches[0].pageX,c=t.gesture.touches[0].pageY,d=t.gesture.touches[1].pageX,p=t.gesture.touches[1].pageY,g=(l+d)/2,h=(c+p)/2;a.offset().left,a.offset().top;f=1==globalType?"50% 47%":"0% 0%"}),r.on("transform",function(t){scaleFactor=n*t.gesture.scale,scaleFactor=Math.max(i,Math.min(scaleFactor,s)),o(t)}),r.on("transformend",function(){n=scaleFactor,u=!1,b=m,b>=360?b-=360:-360>=b&&(b+=360),startRotation=b,degree1=startRotation})}function rotatered(){clearInterval(interval),rotateFn("-",1),interval=setInterval(function(){rotateFn("-",1)},200)}function rotateblue(){clearInterval(interval),rotateFn("+",1),interval=setInterval(function(){rotateFn("+",1)},200)}function rotateFn(t,e){"-"==t?startRotation-=e:startRotation+=e,degree1=startRotation,$("#"+globalId).css("-moz-transform","scaleX("+scaleFactor+") scaleY("+scaleFactor+") rotate("+startRotation+"deg)"),$("#"+globalId).css("-webkit-transform","scaleX("+scaleFactor+") scaleY("+scaleFactor+") rotate("+startRotation+"deg)"),$("#"+globalId).css("transform","scaleX("+scaleFactor+") scaleY("+scaleFactor+") rotate("+startRotation+"deg)"),$("#"+globalId).css("-o-transform","scaleX("+scaleFactor+") scaleY("+scaleFactor+") rotate("+startRotation+"deg)"),$("#"+globalId).css("-ms-transform","scaleX("+scaleFactor+") scaleY("+scaleFactor+") rotate("+startRotation+"deg)")}function getMeta(t){var e=new Image;e.src=t;var o=e.onload=function(){return s={w:e.width,h:e.height},[s.w,s.h]}();return o}function getDimensions(){var t=[$("#"+globalId).css("width"),$("#"+globalId).css("height")];return t}function prompt(){var t="";if(1==globalType)var e="protractor";else var e="set square";return t+='<div id="promptHolder" style="display:none;">',t+='<div id="prompt" style="visibility:hidden;text-align:left;">',osDetection()?(t+="<ol>",t+="<li>To move the "+e+", tap anywhere on the "+e+" and drag.</li>",t+="<li>To turn the "+e+", tap on the arrows on the side of the "+e+" and drag.</li>",t+="<li>To rotate the "+e+", put one finger on the origin and rotate using the second finger.</li>",t+="</ol>"):(t+="<ol>",t+="<li>To move the "+e+", click anywhere on the "+e+" and drag.</li>",t+="<li>To turn the "+e+", click on the arrows on the side of the "+e+" and drag.</li>",t+="</ol>",t+='<div id="arrowText">',t+='<div id="arrows"></div><div id="moveText" class="text">Move</div>',t+="</div>",t+='<div id="both">',t+='<div class="shift"></div> <div class="plus">+</div> <div id="leftkey"></div>  <div class="text">Rotate Left</div>',t+='<div class="shift"></div> <div class="plus">+</div> <div id="rightkey"></div>  <div class="text">Rotate Right</div>',t+="</div>"),t+="</div>",t+='<button id="promptOk" class="promptOkButton" promptNo="" onclick="checkPrompt();"  style="visibility:hidden; width: 45px; background-color: white; font-size: 14px;">OK',t+="</button>",t+="</div>"}function checkPrompt(){$("#promptHolder").hide(),$("#frontScreen").hide()}function showPrompt(t,e){$("#frontScreen").show(),$("#promptHolder").css({top:t+"px",left:e+"px"}),$("#promptHolder").show(),$("#promptHolder").children().css("visibility","visible"),"noAnswer"==$("#promptOk").attr("promptNo")&&$("#promptOk,#msg").css("visibility","hidden"),setTimeout(function(){$("#promptOk").focus()},50)}var source="",isDrag=!1,globalId,protHeight,globalType,flagHeight=!0,h_x,h_y,diffValOpt,degree=0,startRotation=0,angle1=0,degree1=0,speed=0;$(document).ready(function(){$(document).live("keyup",function(){clearInterval(interval),speed=0}),$(document).live("keydown",function(t){t.keyCode=0!=t.keyCode?t.keyCode:t.which,speed++,37==t.keyCode&&1==t.shiftKey?rotatered():39==t.keyCode&&1==t.shiftKey?rotateblue():37==t.keyCode?(t.preventDefault(),parseInt($("#"+globalId).css("left"))>-300&&$("#"+globalId).css("left",parseInt($("#"+globalId).css("left"))-Math.ceil(speed/10))):39==t.keyCode?(t.preventDefault(),parseInt($("#"+globalId).css("left"))<parseInt($("#container").css("width"))+125&&$("#"+globalId).css("left",parseInt($("#"+globalId).css("left"))+Math.ceil(speed/10))):38==t.keyCode?(t.preventDefault(),parseInt($("#"+globalId).css("top"))>-300&&$("#"+globalId).css("top",parseInt($("#"+globalId).css("top"))-Math.ceil(speed/10))):40==t.keyCode&&(t.preventDefault(),parseInt($("#"+globalId).css("top"))<382&&$("#"+globalId).css("top",parseInt($("#"+globalId).css("top"))+Math.ceil(speed/10)))}),document.addEventListener("mousemove",moveProtractor,!1),$(document).mouseup(function(){isDrag=!1,startRotation=degree1}),document.addEventListener("touchend",function(){isDrag=!1,startRotation=degree1})});var scaleFactor=1,interval="",tempDeg=0,dimensionArr;